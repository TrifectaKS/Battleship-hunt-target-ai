try { window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.owa.modernbootreadingpane.js'] = (new Date()).getTime();
function ModernBootReadingPaneComponent(){}ModernBootReadingPaneComponent.$$cctor=function(){_a.t.a().a(ModernBootReadingPaneComponent)};ModernBootReadingPaneComponent.prototype={b:function(n,t,i){var u=this;n.b(IModernConversationItemPartsFactory,function(){return new ConversationItemPartsFactory(n.a(_a.cu),n.a(_h.bb),n.a(_a.f),i)});var r=this;n.b(IGroupConversationItemPartsFactory,function(){return new _bmr.d(n.a(_a.cu),n.a(_a.f),n.a(_a.bo),n.a(_h.bb),i)})},a:function(){return null}};Type.registerNamespace("_bmr");_bmr.b=function(){};_bmr.b.registerInterface("_bmr.b");_bmr.a=function(n,t,i,r,u,f){this.bv=Function.createDelegate(this,this.cn);this.bu=Function.createDelegate(this,this.ck);this.bt=Function.createDelegate(this,this.ce);this.bs=Function.createDelegate(this,this.cc);this.bN=Function.createDelegate(this,this.cm);this.bM=Function.createDelegate(this,this.cl);this.bw=Function.createDelegate(this,this.cp);this.bx=Function.createDelegate(this,this.cq);this.bL=Function.createDelegate(this,this.ci);this.D=new _j.l;this.S={};this.M={};this.br=new _a.k;this.bf=new _a.k;this.bo=new _j.q;this.R=undefined;this.bp=new Sys.EventHandlerList;this.Q=new Sys.EventHandlerList;_bmr.a.initializeBase(this);this.F=t;this.bh=i;this.bc=n;this.bm=r;this.J=u;this.bg=f;this.D.d(this.bL)};_bmr.a.prototype={J:null,bg:null,bh:null,bm:!1,F:null,K:20,bc:0,V:null,bz:null,bI:0,Z:0,O:!1,bH:!1,bJ:!1,be:!1,bd:!1,bl:!1,P:0,bk:!1,bb:null,bC:!1,bq:"",L:!1,T:null,G:null,C:null,bB:0,X:!1,bn:!1,bj:!1,Y:null,ba:0,U:0,H:null,o:function(){return this.F},g:function(){return this.D.x.length},a:function(){return this.D},d:function(){return this.O},bV:function(n){this.O=n;this.eC("Loading");return n},j:function(){return this.bk},bF:function(n){if(this.bk!==n){this.bk=n;this.eC("IsLoadMoreInProgress")}return n},f:function(){return this.be},bE:function(n){if(this.be!==n){this.be=n;this.eC("CanLoadMore")}return n},x:function(){return this.bd},bT:function(n){if(this.bd!==n){this.bd=n;this.eC("CanDelete")}return n},y:function(){return this.bl},bU:function(n){if(this.bl!==n){this.bl=n;this.eC("IsLocked")}return n},B:function(){return this.P},bG:function(n){if(this.P!==n){this.P=n;this.eC("TotalConversationNodesCount");this.eC("ReplyCountLabel")}return n},A:function(){var n=this.P-1;return String.format(_a.bG.e(n,_u.n.SG,_u.n.Q,_u.n.ED),n)},p:function(){return this.bC},h:function(n){this.bC=n;return n},c:function(){return this.bb},v:function(n){this.L=n;return n},e:function(){return this.br},b:function(){return this.bf},s:function(){return this.X||this.bn?"":this.bq},r:function(){return this.bo.i()},k:function(n){return this.M[n]},z:function(){var n=this.Q.getHandler("update");n&&n();this.bD();this.C=null;this.bS()},N:function(){},q:function(n){if(this.K>=100){this.bE(!1);return!1}else{this.K=Math.min(this.K+10,100);var t=this.C||this.G;this.X=!0;this.W(t,200,n);this.bF(!0);return!0}},l:function(n,t,i){this.bS();this.bE(!1);var r=this.C||this.G;this.bn=!0;this.R=t;this.bj=i;this.W(r,200,n)},t:function(n){for(var f=this.D,u=0;u<f.x.length;u++){var e=f.x[u];var t=e.a();if(t)for(var i=0;i<t.b();i++){var r=_h.d.a().a(t.a(i).bD.ItemId.Id);if(r){n(r);if(r.db){this.L=!0;break}}}if(this.L)break}},n:function(n){return this.L?!0:this.C?this.by(n,this.C.S(),this.C.bD.GlobalUnreadCount,this.C.bD.GlobalMessageCount):this.O?this.by(n,this.Y,this.ba,this.U):this.by(n,this.bz,this.bI,this.Z)},i:function(n,t,i){if(this.F.Id!==n.bD.ConversationId.Id)throw Error.argument("conversation.Id");if(this.L){this.l(i);return!0}if(this.n(n)){this.K+=this.cb(n);this.W(n,t,i);return!0}else if(this.O){i&&this.Q.addHandler("update",i);return!0}return!1},w:function(n,t){if(this.F.Id!==n.bD.ConversationId.Id)throw Error.argument("conversation.Id");if(this.J&&this.J.a().k().Enabled){if(this.G)this.W(n,203,t);else if(!this.T){this.Y=n.S();this.ba=n.bD.GlobalUnreadCount;this.U=n.bD.GlobalMessageCount;this.T=t;this.bR(n)}}else this.W(n,201,t)},m:function(n,t){var i=null;var u=n.InternetMessageId;if(!(u in this.M)){var r=new _g.cf(u);r.ParentInternetMessageId=t;Array.add(r.Items,n);i=new _g.ca(r);this.R==="ChronologicalNewestOnTop"||this.R==="NewestOnTop"?this.D.t(0,i):this.D.a(i);this.bG(this.P+1)}return i},u:function(n){var o=n.InternetMessageId;var r=this.M[o];_j.e.a(_a.a.w,"Replacing internetMessageId "+n.InternetMessageId);var t=null;if(r){for(var i=-1,e=!1,f=0;f<r.a().b();f++){var u=r.a().a(f);if(_bc.f.a(u.bD.ItemId)){_j.e.a(_a.a.w,"Found client id"+u.bD.ItemId);i=f}else if(n.ItemId.Id===u.bD.ItemId.Id){_j.e.a(_a.a.w,"Found server id"+u.bD.ItemId.Id);e=!0;t=u}}if(e){if(i>=0){r.a().o(i);_j.e.a(_a.a.w,"Remove client item "+o)}}else{t=_g.g.a(n);if(i>=0){r.a().C(i,t);_j.e.a(_a.a.w,"Replace client item with server item "+n.InternetMessageId+" at "+i)}else{r.a().c(t);_j.e.a(_a.a.w,"Append server item "+n.ItemId.Id)}}}else t=_g.g.a(n);return t},bi:function(n,t){return _h.W.a(n,t.bD.ConversationId.Id,t.bD.ConversationId.ChangeKey,this.K,t.S(),null,"ModernItemPart",this.s(),!this.bm,this.R,this.bj,1,"",this.J,this.bg)},bR:function(n){this.G=n;var t=this.bi(201,n);t.b(this.bx);t.a(this.bw);_a.g.a.a(t)},cq:function(n){if(this.D){var t=n.f[0];this.bG(t.Conversation.TotalConversationNodesCount);this.bT(t.Conversation.CanDelete);this.bU(t.Conversation.IsLocked);this.bW(t.Conversation.ConversationNodes);this.bP(t.Conversation);this.bq=t.Conversation.SyncState;this.bY()}},cp:function(n){if(this.T){this.T();this.T=null}},W:function(n,t,i){this.C=n;this.bB=t;i&&this.bp.addHandler("update",i);this.O||this.bA()},by:function(n,t,i,r){if(t){if(!n.S())return!0;if(t.b(n.S())>0)return!1}return!t||!n.S()?!0:t.b(n.S())<0||i!==n.bD.GlobalUnreadCount||r!==n.bD.GlobalMessageCount?!0:!1},cb:function(n){var t=0;if(this.L)return t;this.C?t=n.bD.GlobalMessageCount-this.C.bD.GlobalMessageCount:this.O?t=n.bD.GlobalMessageCount-this.U:this.Z>0&&(t=n.bD.GlobalMessageCount-this.Z);return Math.max(t,0)},bA:function(){_j.e.a(_bmr.a.a,"Loading item parts for conversation with id {0}.",this.C.bD.ConversationId.Id);this.G=this.C;this.bc=this.bB;this.Q=this.bp;this.bo.f();this.Y=this.G.S();this.ba=this.G.bD.GlobalUnreadCount;this.U=this.G.bD.GlobalMessageCount;var n=this.bi(this.bc,this.C);n.d(this.bM);n.b(this.bN);this.V=n;this.C.F&&(this.H=this.C);this.C=null;this.bp=new Sys.EventHandlerList;this.X=!1;this.bn=!1;this.L=!1;this.bV(!0);this.bF(this.X);_a.g.a.a(n)},bW:function(n){n||(n=[]);this.cr(n);var i=this,r=this,t=this;_h.M.a(this.D,n,function(n){return n.bD.InternetMessageId},function(n){return n.InternetMessageId},function(n,i){var r=n?n:new _g.ca;t.cd(r,i);return r},!0,!1,_bmr.a.a);this.bE(this.D.x.length<this.P)},cr:function(n){_j.e.a(_a.a.w,"Pre-preserve: current="+this.D.x.length+", new="+n.length);var i="OQC:"+this.F.Id;var t=this.bh.c[i];this.bO(n,t);i="OMC:"+this.F.Id;t=this.bh.c[i];this.bO(n,t);_j.e.a(_a.a.w,"Post-preserve: current="+this.D.x.length+", new="+n.length)},bO:function(n,t){if(t&&!t.bf())for(var e=n.length,r=0;r<t.a().d.length;r++){for(var f=t.a().d[r],i=e-1;i>=0;){var o=n[i];if(o.InternetMessageId===f)break;i--}if(i<0){var u=this.M[f];u&&Array.add(n,u.bD)}}},cm:function(n){if(n===this.V){var i=this.Q.getHandler("update");this.bb=n.G;this.bD();var t=n.f[0];this.bG(t.Conversation.TotalConversationNodesCount);this.bT(t.Conversation.CanDelete);this.bU(t.Conversation.IsLocked);this.bW(t.Conversation.ConversationNodes);this.bP(t.Conversation);this.bq=t.Conversation.SyncState;this.bY();this.cs(t.Conversation);i&&i();if(this.C){_j.e.a(_bmr.a.a,"Found pending update request for conversation with id {0}.",this.C.bD.ConversationId.Id);this.bA()}}},cs:function(n){if(this.H&&this.H.bD.ConversationId.Id===n.ConversationId.Id){this.H.x(n.TotalConversationNodesCount);if(n.ConversationNodes&&n.ConversationNodes.length>this.H.a().b()){this.H.a().k();for(var i=0;i<n.ConversationNodes.length;i++){var t=n.ConversationNodes[i];if(t.Items&&t.Items.length>0){var u=t.Items[0];var r=new _g.e(u.ItemId.Id);r.ChangeKey=u.ItemId.ChangeKey;this.H.a().c(r)}}}this.H=null}},bP:function(n){if(n.ToRecipients){this.br.k();this.br.h(n.ToRecipients)}if(n.CcRecipients){this.bf.k();this.bf.h(n.CcRecipients)}},cl:function(n){if(n===this.V){this.H=null;var t=this.Q.getHandler("update");this.bb=n.G;this.bD();t&&t();if(this.C){_j.e.a(_bmr.a.a,"Found pending update request for conversation with id {0}.",this.C.bD.ConversationId.Id);this.bA()}}},bD:function(){this.Q=new Sys.EventHandlerList;this.V=null;this.bV(!1);this.bF(!1)},cd:function(n,t){n.m(t.IsRootNode);t.InternetMessageId&&n.k(t.InternetMessageId);t.ParentInternetMessageId&&n.n(t.ParentInternetMessageId);t.NewParticipants&&n.g(new _a.k(t.NewParticipants));t.InReplyToItem&&n.j(t.InReplyToItem);var r=this,u=this,i=this;_h.M.a(n.a().f,t.Items,function(n){return n.bD.ItemId.Id},function(n){return n.ItemId.Id},function(n,t){if(n){i.bX(n,t);return n}else{var r=_h.d.a().a(t.ItemId.Id);if(r){i.bX(r,t);return r}else return _g.g.a(t)}},!0,!1,_bmr.a.a);this.bo.c(n.bD.InternetMessageId)},bX:function(n,t){if(t.ContainsOnlyMandatoryProperties)n.dN(t);else{t.Subject=n.bD.Subject;if(n.bY()&&!n.bY().bD.IsTruncated&&t.UniqueBody&&t.UniqueBody.IsTruncated){var u=new _g.s(n.bY().a()==="HTML"?"HTML":"Text",n.bY().bD.Value);u.IsTruncated=!0;t.UniqueBody=u}if(n.ce()){var r=new _g.s(n.ce().a()==="HTML"?"HTML":"Text",n.ce().bD.Value);r.IsTruncated=n.ce().bD.IsTruncated;t.NormalizedBody=r}if(n.O()){var i=new _g.s(n.O().a()==="HTML"?"HTML":"Text",n.O().bD.Value);i.IsTruncated=n.O().bD.IsTruncated;t.Body=i}n.l(t)}},ci:function(n,t){var e=t.a;var f=t.b;if(f)for(var o=f,c=o.length,r=0;r<c;++r){var l=o[r];this.ch(l)}if(e)for(var u=e,h=u.length,i=0;i<h;++i){var s=u[i];this.cg(s)}},ch:function(n){var t=n;delete this.M[t.bD.InternetMessageId];t.a().k();t.a().q(this.bs);if(!this.D.x.length&&!this.bJ){_h.u.b().a(this.F.Id,2,this.bt);_h.u.b().a(this.F.Id,1,this.bu);this.bJ=!0}},cg:function(n){var t=n;this.M[t.bD.InternetMessageId]=t;for(var i=0;i<t.a().b();i++){var r=t.a().a(i);this.bQ(r,t)}t.a().p(this.bs);if(!this.bH){_h.u.b().b(this.F.Id,2,this.bt);_h.u.b().b(this.F.Id,1,this.bu);this.bH=!0}},cc:function(n,t){var r=t.a;var u=t.b;var i=null;if(u&&u.length){i=this.S[u[0].bD.ItemId.Id];for(var o=u,l=o.length,f=0;f<l;++f){var a=o[f];this.co(a)}}if(r&&r.length){i||(i=this.ca(r[0].bD.ItemId.Id));for(var s=r,c=s.length,e=0;e<c;++e){var h=s[e];this.bQ(h,i)}}i&&!i.a().b()&&this.D.p(i,!0)},co:function(n){var t=n;delete this.S[t.bD.ItemId.Id];_h.d.a().c(t.bD.ItemId.Id);t.dB(this.bv)},bQ:function(n,t){this.S[n.bD.ItemId.Id]=t;_h.d.a().e(n.bD.ItemId.Id)?_h.d.a().d(n.bD.ItemId.Id):_h.d.a().b(n.bD.ItemId.Id,n);n.dD(this.bv)},cn:function(n,t){var r=n;var i=this.S[r.bD.ItemId.Id];i&&i.a().m(r)},ce:function(n,t){for(var f=n,i=0;i<f.a().b();i++){var e=f.a().a(i).Id;var r=this.S[e];var u=_h.d.a().a(e);u&&r&&r.a().m(u)}},ck:function(n,t){var r=n;var i=t;i.a==="UnreadCount"?this.cj(r):i.a==="GlobalUnreadCount"&&this.cf(r)},cj:function(n){var r=!1;if(n.bD.UnreadCount===n.a().b())r=!1;else if(n.bD.UnreadCount)return;else r=!0;for(var i=0;i<n.a().b();i++){var t=_h.d.a().a(n.a().a(i).Id);t&&t.dd()&&t.j(r)}},cf:function(n){var r=!1;if(n.bD.GlobalUnreadCount===n.c().b())r=!1;else if(n.bD.GlobalUnreadCount)return;else r=!0;for(var i=0;i<n.c().b();i++){var t=_h.d.a().a(n.c().a(i).Id);t&&t.dd()&&t.j(r)}},ca:function(n){for(var t=0;t<this.D.x.length;t++){var i=this.D.x[t];if(this.bZ(i,n))return i}return null},bZ:function(n,t){if(!n||!n.a())return!1;for(var i=0;i<n.a().b();i++)if(n.a().a(i).bD.ItemId.Id===t)return!0;return!1},bS:function(){for(var i=this.D.x.length-1;i>=0;--i)for(var t=this.D.x[i],n=t.a().b()-1;n>=0;--n){var r=t.a().a(n);t.a().o(n)}},bY:function(){this.bz=this.Y;this.Z=this.U;this.bI=this.ba}};function ConversationItemPartsFactory(n,t,i,r){this.c=n;this.e=t;this.d=i;this.b=r}ConversationItemPartsFactory.prototype={c:null,e:null,d:null,b:null,a:function(n,t){return new _bmr.a(n,t,this.c,this.e.a(),this.d,this.b)}};_bmr.c=function(n,t,i,r,u,f,e){_bmr.c.initializeBase(this,[n,t,i,e,r,u]);this.K=4;this.R="ChronologicalNewestOnBottom";this.bK=f};_bmr.c.prototype={bK:null,ct:function(){return!!this.J&&this.J.a().ee().Enabled},bi:function(n,t){var r=t.bD.FolderId;var i=r.a.Mailbox.EmailAddress;return _h.W.a(n,t.bD.ConversationId.Id,t.bD.ConversationId.ChangeKey,this.K,t.S(),null,"ModernItemPart",this.s(),!this.bm,"ChronologicalNewestOnBottom",this.bj,2,i,this.J,this.bg,this.ct(),this.bK)},bR:function(n){this.G=n;var t=this.bi(702,n);t.b(this.bx);t.a(this.bw);_a.g.a.a(t)}};_bmr.d=function(n,t,i,r,u){_bmr.d.initializeBase(this,[n,r,t,u]);this.f=i};_bmr.d.prototype={f:null,a:function(n,t){return new _bmr.c(n,t,this.c,this.d,this.b,this.f,this.e.a())}};ModernBootReadingPaneComponent.registerClass("ModernBootReadingPaneComponent",null,_a.jb,_j.cd);_bmr.a.registerClass("_bmr.a",_a.co,_h.bG,_bmr.b,IConversationItemParts,_j.br,Sys.IDisposable);ConversationItemPartsFactory.registerClass("ConversationItemPartsFactory",null,IModernConversationItemPartsFactory,IConversationItemPartsFactory);_bmr.c.registerClass("_bmr.c",_bmr.a);_bmr.d.registerClass("_bmr.d",ConversationItemPartsFactory,IGroupConversationItemPartsFactory,IConversationItemPartsFactory);ModernBootReadingPaneComponent.$$cctor();_bmr.a.a=_a.a.T;
window.scriptsLoaded['microsoft.owa.modernbootreadingpane.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.owa.modernbootreadingpane.js'] = (new Date()).getTime(); } catch(e) { window.owaLastErrorReported = e; throw e; }
